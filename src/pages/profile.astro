---
// src/pages/yourPage.astro
import ProfileView from "../components/profile/profile.vue";
import Layout from "../layouts/Layout.astro";
import { auth } from "../firebase"; // Importa tu configuración de Firebase
import { getAuth } from "firebase/auth"; // Para manejar la autenticación

// Obtener las cookies del request
const { searchParams } = Astro.url;
const { request } = Astro;  

// Extraer la cookie de sesión
const cookies = request.headers.get("cookie") || "";
const sessionCookie = cookies
  .split(";")
  .find((cookie) => cookie.trim().startsWith("session=")) as string;

let decodedClaims;

try {
  // Verificar la sesión del usuario con Firebase Admin
  decodedClaims = await auth.verifySessionCookie(sessionCookie.split("=")[1]);
  console.log("Usuario autenticado:", decodedClaims);
} catch (error) {
  console.error('Error al verificar la sesión:', error);
  
  // Aquí debes manejar la redirección al login para realizar el inicio automático
  // Si quieres permitir un inicio de sesión automático con un ID Token, este paso no es necesario
  return Astro.redirect("/login");
}

// El usuario está autenticado, se renderiza el contenido
---
<Layout title="HalloweenMe app - Cloudinary Hackatho">
  <ProfileView client:only />
</Layout>
