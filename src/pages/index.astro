---
import Layout from "../layouts/Layout.astro"
import { CldUploadWidget, CldImage } from "astro-cloudinary"
import { getCollection } from "astro:content"
import Faq from "../components/faq/faq.vue"  

const images = await getCollection("images")
import '../styles/global.css';
---

<Layout title="Generador Halloween - Cloudinary Hackathon">
  <main class="min-h-screen bg-orange-900 flex flex-col items-center justify-center p-4">
    <div class="max-w-md w-full bg-black rounded-lg shadow-2xl overflow-hidden">
      <div class="p-6 space-y-6">
        <h1 class="text-3xl font-extrabold text-orange-500 text-left">
          Generador de imágenes Halloween
        </h1>
        
        <!-- Sección de ayuda -->
        <div class="bg-gray-800 text-white p-4 rounded-lg text-left">
          <h2 class="text-xl font-bold mb-2">¿Cómo usar esta herramienta?</h2>
          <ol class="list-decimal list-inside space-y-1">
            <li>Sube tu imagen</li>
            <li>Elige un tema</li>
            <li>Pulsa en crear</li>
            <li>Espera a que termine</li>
            <li>¡ Listo ! Ya puedes comportir tu imagen</li>
          </ol>
        </div>

        <!-- Componente de subida de imágenes -->
        <CldUploadWidget
          id="upload-widget"
          uploadPreset="upload-unsigned-images"
          options={{
            sources: ["local"],
            multiple: false,
            maxFiles: 1,
            language: "es",
            text: {
              es: {
                or: "O",
                menu: {
                  files: "Subir desde tu dispositivo",
                },
                local: {
                  browse: "Seleccionar",
                  dd_title_single: "Arrastra tu imagen aquí",
                },
              },
            },
          }}
        >
          <button class="mt-6 w-full py-3 px-6 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-full transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-orange-400 focus:ring-opacity-50">
            Subir imagen
          </button>
        </CldUploadWidget>

        <ul class="grid grid-cols-2 gap-4 mt-6">
          {images.map((image) => (
            <li>
              <a href={`/photo?id=${image.data.public_id}`}>
                <CldImage
                  src={image.data.public_id}
                  width={250}
                  height={250}
                  crop={{
                    type: "fill",
                    source: true,
                  }}
                  class="rounded-lg border-4 border-orange-500"
                />
              </a>
            </li>
          ))}
        </ul>
      </div>
    </div>
    <Faq   client:only />

  </main>

  <script>
    import { navigate } from "astro:transitions/client"
    
    const widget = document.getElementById("upload-widget")

    if (widget) {
      widget.addEventListener("clduploadwidget:success", ((
        e: CustomEvent<{ info: { public_id: string } }>
      ) => {
        const publicId = e.detail.info.public_id
        navigate(`/photo?id=${publicId}`)
      }) as EventListener)
    }
  </script>

  <style scoped>
    main {
      text-align: center;
    }

    ul {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 4px;
      list-style: none;
    }
  </style>
</Layout>
